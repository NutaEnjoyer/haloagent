# üß™ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é AI –∑–≤–æ–Ω–∫–æ–≤

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ç–µ—Å—Ç—É

### ‚úÖ –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å

1. **OpenAI API Key** - ‚úÖ –µ—Å—Ç—å –≤ .env
2. **Voximplant –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - ‚úÖ –µ—Å—Ç—å –≤ .env
3. **ngrok URL** - ‚ö†Ô∏è –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è
4. **–¢–µ—Å—Ç–æ–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω** - –Ω—É–∂–µ–Ω –¥–ª—è –ø—Ä–∏–µ–º–∞ –∑–≤–æ–Ω–∫–∞

### –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```
BACKEND_URL=https://e537cde5faed.ngrok-free.app
VOXIMPLANT_CALLER_ID=+78652594087
–¢–µ—Å—Ç–æ–≤—ã–π –Ω–æ–º–µ—Ä (–∏–∑ –ª–æ–≥–æ–≤): +79019433546
```

---

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ ngrok (–µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω)

–í **–Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ**:

```bash
ngrok http 8000
```

**–í–ê–ñ–ù–û:** –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://abc123.ngrok-free.app`)

–ï—Å–ª–∏ URL –∏–∑–º–µ–Ω–∏–ª—Å—è, –æ–±–Ω–æ–≤–∏—Ç–µ .env:
```bash
BACKEND_URL=https://–≤–∞—à-–Ω–æ–≤—ã–π-url.ngrok-free.app
```

---

### –®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–π –≤ Voximplant

```bash
python update_to_streaming_scenario.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ Scenario 'OutboundCallStreaming' uploaded successfully!
```

–ó–∞—Ç–µ–º **–≤—Ä—É—á–Ω—É—é –≤ Voximplant Console**:
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://manage.voximplant.com
2. Applications ‚Üí halodemo ‚Üí Rules
3. –ù–∞–π–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–æ (Rule ID: 8111375)
4. –ò–∑–º–µ–Ω–∏—Ç–µ Scenario –Ω–∞ **"OutboundCallStreaming"**
5. **Save**

---

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç–µ Backend —Å–µ—Ä–≤–µ—Ä

–í **–Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ** (–∏–ª–∏ —Ç–µ–∫—É—â–µ–º):

```bash
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
INFO: Starting Voice Caller API...
INFO: Initializing OpenAI client...
INFO: Initializing Telephony adapter (Voximplant mode)...
INFO: Voice Caller API started successfully
INFO: Uvicorn running on http://0.0.0.0:8000
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ health:
```bash
curl http://localhost:8000/health
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
```json
{
  "status": "ok",
  "timestamp": "...",
  "active_calls": 0,
  "version": "1.0.0"
}
```

---

### –®–∞–≥ 4: –°–¥–µ–ª–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫

–í **–Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ**:

```bash
curl -X POST http://localhost:8000/calls \
  -H "Content-Type: application/json" \
  -d "{\"phone\": \"+79019433546\"}"
```

**–ó–∞–º–µ–Ω–∏—Ç–µ –Ω–æ–º–µ—Ä** –Ω–∞ –≤–∞—à —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω!

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "call_id": "9eba5160-...",
  "phone": "+79019433546",
  "status": "pending",
  "created_at": "..."
}
```

---

## üì± –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏

### 1. **–í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω –∑–∞–∑–≤–æ–Ω–∏—Ç**
   - Caller ID: +78652594087
   - –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –∑–≤–æ–Ω–æ–∫

### 2. **–£—Å–ª—ã—à–∏—Ç–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ:**
   > "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –≥–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∫–æ–º–ø–∞–Ω–∏–∏ HALO. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?"

### 3. **–ì–æ–≤–æ—Ä–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å:**
   –ù–∞–ø—Ä–∏–º–µ—Ä: *"–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —Ö–æ—á—É —É–∑–Ω–∞—Ç—å –æ –≤–∞—à–∏—Ö —É—Å–ª—É–≥–∞—Ö"*

### 4. **–ñ–¥–∏—Ç–µ ~3-5 —Å–µ–∫—É–Ω–¥**
   (–ø–æ–∫–∞ –∞—É–¥–∏–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ OpenAI)

### 5. **–£—Å–ª—ã—à–∏—Ç–µ –æ—Ç–≤–µ—Ç –ò–ò:**
   > "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –° —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º —Ä–∞—Å—Å–∫–∞–∂—É –æ –Ω–∞—à–∏—Ö —É—Å–ª—É–≥–∞—Ö. –ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º..."

### 6. **–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –¥–∏–∞–ª–æ–≥**
   –ì–æ–≤–æ—Ä–∏—Ç–µ ‚Üí –ø–∞—É–∑–∞ 2 —Å–µ–∫ ‚Üí –ò–ò –æ—Ç–≤–µ—á–∞–µ—Ç ‚Üí –ø–æ–≤—Ç–æ—Ä

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

### Backend –ª–æ–≥–∏ (–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω uvicorn):

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**

```
[Voximplant] Initiating call | call_id=xxx | phone=+79019433546
[Voximplant] Call initiated successfully | call_id=xxx

[Voximplant Webhook] Received event | call_id=xxx | event=Connected
[Orchestrator] telephony_event_answered | call_id=xxx

[Voximplant Audio] Processing audio | call_id=xxx | url=https://... | duration=3.2s
[Voximplant Audio] Downloaded 51234 bytes
STT completed in 0.523s | text_length=45
[Voximplant Audio] User said: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —Ö–æ—á—É —É–∑–Ω–∞—Ç—å –æ –≤–∞—à–∏—Ö —É—Å–ª—É–≥–∞—Ö
GPT completed in 1.234s | tokens=234
[Voximplant Audio] AI response: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –° —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º —Ä–∞—Å—Å–∫–∞–∂—É...

[Voximplant Webhook] Received event | call_id=xxx | event=Disconnected
```

### Voximplant –ª–æ–≥–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://manage.voximplant.com
2. History ‚Üí Call Sessions
3. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à –∑–≤–æ–Ω–æ–∫ (–ø–æ –≤—Ä–µ–º–µ–Ω–∏)
4. –ö–ª–∏–∫–Ω–∏—Ç–µ ‚Üí Session Transcript

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
=== Streaming Scenario Started ===
call_id: xxx
phone: +79019433546

=== Call Connected ===
Playing greeting...

=== Starting to listen ===
Recording user speech...

[Record] Started recording
[Record] Stopped recording
[Record] URL: https://storage-gw...
[Record] Duration: 3.2s

[Processing] Sending audio to Backend...
[Processing] Backend response received
[Processing] User said: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ...
[Processing] AI response: –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!...
```

---

## ‚ùå –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "Backend –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç webhook"
**–°–∏–º–ø—Ç–æ–º—ã:** –ó–≤–æ–Ω–æ–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ ngrok –∑–∞–ø—É—â–µ–Ω
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ BACKEND_URL –≤ .env —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å ngrok URL
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "OpenAI API –æ—à–∏–±–∫–∞ 401"
**–°–∏–º–ø—Ç–æ–º—ã:** –í –ª–æ–≥–∞—Ö `STT failed` –∏–ª–∏ `GPT failed` —Å –∫–æ–¥–æ–º 401

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ OPENAI_API_KEY –≤ .env
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–ª—é—á –≤–∞–ª–∏–¥–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å credits –Ω–∞ account.openai.com

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "–ó–≤–æ–Ω–æ–∫ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç"
**–°–∏–º–ø—Ç–æ–º—ã:** –¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ –∑–≤–æ–Ω–∏—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å Voximplant
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–æ–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (+7...)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Rule –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π

### –ü—Ä–æ–±–ª–µ–º–∞ 4: "–î–æ–ª–≥–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏"
**–°–∏–º–ø—Ç–æ–º—ã:** –ú–µ–∂–¥—É —Ä–µ–ø–ª–∏–∫–∞–º–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç 5-10 —Å–µ–∫—É–Ω–¥

**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!** HTTP-based –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
- –ó–∞–ø–∏—Å—å –∞—É–¥–∏–æ: ~2-5 —Å–µ–∫
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ + STT + GPT + TTS: ~2-5 —Å–µ–∫
- **–ò—Ç–æ–≥–æ:** 4-10 —Å–µ–∫—É–Ω–¥

–î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ real-time –Ω—É–∂–µ–Ω WebSocket streaming (—Å–ª–æ–∂–Ω–µ–µ).

### –ü—Ä–æ–±–ª–µ–º–∞ 5: "Backend –Ω–µ –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å audio"
**–°–∏–º–ø—Ç–æ–º—ã:** `Failed to download audio: 403` –∏–ª–∏ `404`

**–†–µ—à–µ–Ω–∏–µ:**
1. Voximplant –∑–∞–ø–∏—Å–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ (~24 —á–∞—Å–∞)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ URL –¥–æ—Å—Ç—É–ø–µ–Ω
3. –í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

–¢–µ—Å—Ç **–£–°–ü–ï–®–ï–ù** –µ—Å–ª–∏:

- ‚úÖ –¢–µ–ª–µ—Ñ–æ–Ω –∑–∞–∑–≤–æ–Ω–∏–ª
- ‚úÖ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–∏–≥—Ä–∞–Ω–æ
- ‚úÖ –ü–æ—Å–ª–µ –≤–∞—à–µ–π —Ä–µ—á–∏ –∏ –ø–∞—É–∑—ã 2 —Å–µ–∫ - –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å
- ‚úÖ Backend –ø–æ–ª—É—á–∏–ª audio_url
- ‚úÖ OpenAI —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–ª —Ä–µ—á—å
- ‚úÖ GPT —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –æ—Ç–≤–µ—Ç
- ‚úÖ Voximplant –ø—Ä–æ–∏–∑–Ω–µ—Å –æ—Ç–≤–µ—Ç
- ‚úÖ –¶–∏–∫–ª –ø–æ–≤—Ç–æ—Ä–∏–ª—Å—è –º–∏–Ω–∏–º—É–º 1 —Ä–∞–∑

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:**

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è |
|----------|-------|
| –ó–∞–ø–∏—Å—å —Ä–µ—á–∏ | 2-5 —Å–µ–∫ |
| –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ | 0.1-0.5 —Å–µ–∫ |
| Whisper STT | 0.3-1 —Å–µ–∫ |
| GPT-4 –≥–µ–Ω–µ—Ä–∞—Ü–∏—è | 1-3 —Å–µ–∫ |
| Voximplant TTS | 0.5-2 —Å–µ–∫ |
| **–ò–¢–û–ì–û –∑–∞ —Ü–∏–∫–ª** | **4-11 —Å–µ–∫** |

**–ï—Å–ª–∏ –º–µ–¥–ª–µ–Ω–Ω–µ–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫—É OpenAI API (status.openai.com)
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤ –¥—Ä—É–≥–æ–µ –≤—Ä–µ–º—è

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

1. **–£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç** - –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `SYSTEM_PROMPT` –≤ `app/integrations/openai_client.py`
2. **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç** - —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞
3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ streaming responses
4. **–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é** - –æ–ø—Ä–µ–¥–µ–ª—è–π—Ç–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥ –±–∏–∑–Ω–µ—Å** - –∞–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ–¥ –≤–∞—à–∏ –Ω—É–∂–¥—ã

---

## üìû –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç-—Å–∫—Ä–∏–ø—Ç

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ `quick_test.sh`:

```bash
#!/bin/bash

echo "üß™ Quick AI Call Test"
echo "===================="
echo ""
echo "1. Checking backend..."
curl -s http://localhost:8000/health | jq
echo ""
echo "2. Making test call..."
curl -X POST http://localhost:8000/calls \
  -H "Content-Type: application/json" \
  -d '{"phone": "+79019433546"}' | jq
echo ""
echo "3. Check your phone! ‚òéÔ∏è"
```

–ó–∞–ø—É—Å–∫:
```bash
chmod +x quick_test.sh
./quick_test.sh
```

---

**–£–¥–∞—á–∏ —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º! üöÄ**
