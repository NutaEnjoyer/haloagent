# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã RecordStopped

## üîç –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã

–ü–æ—Å–ª–µ –ø–æ–∏—Å–∫–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ —è –Ω–∞—à—ë–ª **–∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é** –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Voximplant:

> **CallEvents.RecordStopped —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ü–û–°–õ–ï CallEvents.Disconnected**

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ `RecordStopped` –∏ URL –∑–∞–ø–∏—Å–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã **—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–≤–æ–Ω–∫–∞**, –∞ –Ω–µ –≤–æ –≤—Ä–µ–º—è –Ω–µ–≥–æ!

### –ü–æ—á–µ–º—É –Ω–∞—à –ø–æ–¥—Ö–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª:

```javascript
// –ù–∞—à —Å—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ (–ù–ï –†–ê–ë–û–¢–ê–ï–¢):
call.record({timeout: 5000});

call.addEventListener(CallEvents.RecordStarted, function() {
    Logger.write("–ó–∞–ø–∏—Å—å –Ω–∞—á–∞–ª–∞—Å—å"); // ‚úÖ –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
});

call.addEventListener(CallEvents.RecordStopped, function(e) {
    Logger.write("–ó–∞–ø–∏—Å—å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞"); // ‚ùå –ù–ï –°–†–ê–ë–ê–¢–´–í–ê–ï–¢ –≤–æ –≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞!
    processAudio(e.url);                 // ‚ùå URL –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ hangup
});
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
1. ‚úÖ –ó–∞–ø–∏—Å—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è (RecordStarted)
2. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç
3. ‚è±Ô∏è Timeout –∏—Å—Ç–µ–∫–∞–µ—Ç
4. ‚ùå RecordStopped –ù–ï —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç... –ø–æ—Ç–æ–º—É —á—Ç–æ –∑–≤–æ–Ω–æ–∫ –µ—â—ë –∞–∫—Ç–∏–≤–µ–Ω!
5. ‚ùå –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ `call.hangup()` RecordStopped –±—ã —Å—Ä–∞–±–æ—Ç–∞–ª, –Ω–æ —Å—Ü–µ–Ω–∞—Ä–∏–π —É–∂–µ –∑–∞–≤–µ—Ä—à—ë–Ω

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ASR

Voximplant –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π **ASR (Automatic Speech Recognition)** –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏!

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ ASR:

- ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ **–≤–æ –≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞**
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ —Å–æ–±—ã—Ç–∏–µ `ASREvents.Result`
- ‚úÖ –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞–ø—Ä—è–º—É—é, –±–µ–∑ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∞—É–¥–∏–æ
- ‚úÖ –ú–æ–∂–µ–º —Å—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –≤ OpenAI GPT
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Google, Yandex, Microsoft, Amazon ASR
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ (–Ω–µ –Ω—É–∂–Ω–æ —Å–∫–∞—á–∏–≤–∞—Ç—å —Ñ–∞–π–ª –∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞—Ç—å)

### –ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ —Å ASR:

```javascript
require(Modules.ASR);

// –°–æ–∑–¥–∞—ë–º ASR –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
var asr = VoxEngine.createASR({
    profile: ASRProfileList.Google.ru_RU,
    interimResults: false  // –¢–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
});

// –°–æ–±—ã—Ç–∏–µ: —Ä–µ—á—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞
asr.addEventListener(ASREvents.SpeechDetected, function() {
    Logger.write("–†–µ—á—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞!");
});

// –°–æ–±—ã—Ç–∏–µ: –∞—É–¥–∏–æ –∑–∞—Ö–≤–∞—á–µ–Ω–æ, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
asr.addEventListener(ASREvents.SpeechCaptured, function() {
    Logger.write("–ê—É–¥–∏–æ –∑–∞—Ö–≤–∞—á–µ–Ω–æ, —Ä–∞—Å–ø–æ–∑–Ω–∞—é...");
    call.stopMediaTo(asr);  // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
});

// –°–æ–±—ã—Ç–∏–µ: –†–ï–ó–£–õ–¨–¢–ê–¢ –†–ê–°–ü–û–ó–ù–ê–í–ê–ù–ò–Ø! (–∫–ª—é—á–µ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ)
asr.addEventListener(ASREvents.Result, function(e) {
    Logger.write("–†–µ–∑—É–ª—å—Ç–∞—Ç: " + e.text);
    Logger.write("–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: " + e.confidence);

    // –°—Ä–∞–∑—É –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç —Å OpenAI GPT
    processTextWithAI(e.text);
});

// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∞—É–¥–∏–æ –∏–∑ –∑–≤–æ–Ω–∫–∞ –≤ ASR
call.sendMediaTo(asr);
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ê—Å–ø–µ–∫—Ç | call.record() | ASR |
|--------|--------------|-----|
| **–ö–æ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç** | ‚ùå –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–≤–æ–Ω–∫–∞ | ‚úÖ –í–æ –≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞ |
| **–°–æ–±—ã—Ç–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö** | RecordStopped (–ø–æ—Å–ª–µ hangup) | ASREvents.Result (–≤–æ –≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞) |
| **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö** | URL –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞ | –¢–µ–∫—Å—Ç –Ω–∞–ø—Ä—è–º—É—é |
| **–ù—É–∂–Ω–æ —Å–∫–∞—á–∏–≤–∞—Ç—å —Ñ–∞–π–ª** | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |
| **–ù—É–∂–Ω–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞—Ç—å** | ‚úÖ –î–∞ (OpenAI Whisper) | ‚ùå –ù–µ—Ç (ASR —É–∂–µ —Å–¥–µ–ª–∞–ª) |
| **–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–∏–∞–ª–æ–≥–∞** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| **–°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏** | –ú–µ–¥–ª–µ–Ω–Ω–æ | –ë—ã—Å—Ç—Ä–æ |

---

## üÜï –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### 1. –ù–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: `voximplant_scenario_ASR.js`

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `require(Modules.ASR)`
- –°–æ–∑–¥–∞—ë—Ç ASR —Å –ø—Ä–æ—Ñ–∏–ª–µ–º Google –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
- –°–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ `ASREvents.Result` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `/process_text`

### 2. –ù–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –±—ç–∫–µ–Ω–¥–∞: `/process_text`

**–§–∞–π–ª:** `app/api/routes_voximplant.py`

```python
@router.api_route("/process_text", methods=["GET", "POST"])
async def process_text(request: Request):
    """
    –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —É–∂–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç ASR,
    –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ OpenAI GPT –¥–ª—è –æ—Ç–≤–µ—Ç–∞.
    """
    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç (–∞ –Ω–µ –∞—É–¥–∏–æ!)
    user_text = params.get("user_text")

    # –°—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ GPT (—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –Ω–µ –Ω—É–∂–Ω–∞!)
    ai_text = await openai_client.get_ai_response(
        user_text,
        context="–í—ã - –≤–µ–∂–ª–∏–≤—ã–π –≥–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∫–æ–º–ø–∞–Ω–∏–∏ HALO."
    )

    return {"user_text": user_text, "ai_text": ai_text}
```

**–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `/process_audio`:**
- ‚ùå –ù–µ —Å–∫–∞—á–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ—Ñ–∞–π–ª
- ‚ùå –ù–µ –≤—ã–∑—ã–≤–∞–µ—Ç OpenAI Whisper –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
- ‚úÖ –°—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ GPT
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ

### 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

**–°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ (–ù–ï –†–ê–ë–û–¢–ê–õ):**
```
–ó–≤–æ–Ω–æ–∫ ‚Üí call.record() ‚Üí ‚è±Ô∏è Timeout ‚Üí ‚ùå RecordStopped –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
```

**–ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ (–†–ê–ë–û–¢–ê–ï–¢):**
```
–ó–≤–æ–Ω–æ–∫ ‚Üí ASR ‚Üí SpeechDetected ‚Üí SpeechCaptured ‚Üí
‚Üí ASREvents.Result (—Ç–µ–∫—Å—Ç!) ‚Üí /process_text ‚Üí
‚Üí OpenAI GPT ‚Üí –û—Ç–≤–µ—Ç ‚Üí call.say() ‚Üí –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞
```

---

## üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞ –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Voximplant:

- [CallEvents API Reference](https://voximplant.com/docs/references/voxengine/callevents)
- [ASR (Automatic Speech Recognition)](https://voximplant.com/docs/guides/speech/asr)
- [ASREvents API Reference](https://voximplant.com/docs/references/voxengine/asrevents)
- [Speech Recognition Guide](https://voximplant.com/docs/introduction/what_can_be_done/programmable_voice/speech_recognition/asr)
- [Voximplant ASR Example (GitHub)](https://gist.github.com/aylarov/4e96a4520cedf24dc04fcb71f42115a8)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç –∏ –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!

**–ß—Ç–æ –æ–∂–∏–¥–∞—Ç—å:**
1. ‚úÖ –ó–≤–æ–Ω–æ–∫ —Å–æ–µ–¥–∏–Ω–∏—Ç—Å—è
2. ‚úÖ –í—ã —É—Å–ª—ã—à–∏—Ç–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –≥–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∫–æ–º–ø–∞–Ω–∏–∏ HALO. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?"
3. ‚úÖ ASR –Ω–∞—á–Ω—ë—Ç —Å–ª—É—à–∞—Ç—å (—Å–æ–±—ã—Ç–∏–µ SpeechDetected –≤ –ª–æ–≥–∞—Ö)
4. ‚úÖ –ö–æ–≥–¥–∞ –≤—ã –≥–æ–≤–æ—Ä–∏—Ç–µ, ASR –∑–∞—Ö–≤–∞—Ç–∏—Ç –∞—É–¥–∏–æ (SpeechCaptured)
5. ‚úÖ –ü–æ—Å–ª–µ –ø–∞—É–∑—ã ASR –≤–µ—Ä–Ω—ë—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (ASREvents.Result)
6. ‚úÖ –¢–µ–∫—Å—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –≤ OpenAI GPT
7. ‚úÖ –í—ã —É—Å–ª—ã—à–∏—Ç–µ –æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
8. ‚úÖ ASR —Å–Ω–æ–≤–∞ –Ω–∞—á–Ω—ë—Ç —Å–ª—É—à–∞—Ç—å –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞
9. üîÑ –¶–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–æ 12 —Ä–µ–ø–ª–∏–∫ –∏–ª–∏ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–≤–æ–Ω–∫–∞

**–ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ª–æ–≥–∞—Ö:**
```
[ASR] Speech detected!
[ASR] Speech captured, recognizing...
[ASR] Result received!
[ASR] Text: [—á—Ç–æ —Å–∫–∞–∑–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å]
[ASR] Confidence: 0.95
[ASR] Backend response: 200
[ASR] AI: [–æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞]
```

---

## üéØ –ò—Ç–æ–≥

**–ü—Ä–æ–±–ª–µ–º–∞:**
- RecordStopped —Å–æ–±—ã—Ç–∏–µ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª–æ –≤–æ –≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞ (–ø–æ –¥–∏–∑–∞–π–Ω—É Voximplant)

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ASR –¥–ª—è real-time —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏
- –ü–æ–ª—É—á–∞—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ ASREvents.Result
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –≤–æ –≤—Ä–µ–º—è –∑–≤–æ–Ω–∫–∞, –∞ –Ω–µ –ø–æ—Å–ª–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π –≥–æ–ª–æ—Å–æ–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å –¥–∏–∞–ª–æ–≥–æ–º
- ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–º–µ–Ω—å—à–µ API-–≤—ã–∑–æ–≤–æ–≤)
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

**–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É! üöÄ**
